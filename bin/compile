#!/usr/bin/env bash
set -o errexit
set -o nounset

BUILD_DIR=$1
CACHE_DIR=$2
NODE_VER="v4.2.3"
PATH_SH=$BUILD_DIR/.profile.d/path.sh
URL="https://nodejs.org/dist/$NODE_VER/node-$NODE_VER-linux-x64.tar.gz"

# Create directories
mkdir -p $BUILD_DIR/.profile.d/
mkdir -p $BUILD_DIR/vendor

# Download binary
curl $URL -s -o - | tar xzf - -C $BUILD_DIR/vendor/

# Export path
export PATH=$PATH:"$BUILD_DIR/vendor/node-$NODE_VER-linux-x64/bin"
echo "PATH=$PATH:$HOME/vendor/node-$NODE_VER-linux-x64/bin" > $PATH_SH

# Install packages
cd $BUILD_DIR/src/server/
npm install
